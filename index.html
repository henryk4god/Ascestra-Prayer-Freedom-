<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ... [all your existing variable declarations] ...

    // Form submission
    prayerForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const familyHistory = document.getElementById('familyHistory').value;
      
      // Show loading state
      generateBtn.disabled = true;
      btnText.textContent = 'Generating...';
      btnSpinner.style.display = 'inline-block';
      errorMessage.style.display = 'none';
      
      try {
        // ðŸ”‘ SAFE: Call your Google Apps Script backend (NO KEY in frontend!)
        const response = await fetch('https://script.google.com/macros/s/AKfycbyuLkEZQqKE1QByuAeHcMWAW1cH3jSMtCM4Li4CGoxgsoqHksmy-rsZikZGxBk9xlKugA/exec', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            familyHistory: familyHistory,
            selectedDays: selectedDays
          })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error?.message || 'Failed to generate prayer points');
        }
        
        // Display results
        prayerPoints.textContent = data.choices[0].message.content;
        resultContainer.style.display = 'block';
        
        // Initialize progress tracking
        initializeProgress(selectedDays);
        
        // Scroll to results
        resultContainer.scrollIntoView({ behavior: 'smooth' });
        
      } catch (error) {
        console.error('Error:', error);
        errorMessage.textContent = error.message || 'An unexpected error occurred. Please try again.';
        errorMessage.style.display = 'block';
      } finally {
        // Reset button state
        generateBtn.disabled = false;
        btnText.textContent = 'Generate Prayer Points';
        btnSpinner.style.display = 'none';
      }
    });
    
    // ... [rest of your code remains the same] ...
  });
</script>
